# シナリオ: cloud_breach_s3

**サイズ:** 小

**難しさ:** 普通

**Command:** `$ ./cloudgoat.py create cloud_breach_s3`

## シナリオリソース

* 1 VPC with:
  * EC2 x 1
  * S3 x 1

## 最初の情報

1. 間違って設定されたリバースプロキシサーバのIPアドレス

## シナリオの目的

S3バケットから機密ファイルを取得する。

## 要約

アクセスも権限もない状態から、間違って設定されたリバースプロキシを使ってEC2メタデータサービスにクエリを投げ、インスタンスプロファイルキーを取得します。そして、このキーを使ってS3バケットの発見、アクセス、そして機密データを取得します。

## 攻撃経路

![Scenario Route(s)](https://www.lucidchart.com/publicSegments/view/3ffe907e-6281-47e9-b7bf-e07fdcb48103/image.png)

## ガイド - 匿名のアタッカー

1. なにがしかの方法でEC2インスタンスのIPアドレスを発見したアタッカーは、調査の末でそれがリバースプロキシサーバとして動いていることを見つけました。これはよくあることで、特に企業がオンプレミスからクラウドへ移行する時によく見られます。
2. さらなる調査の後、アタッカーはhostヘッダーをEC2メタデータサービスのものに変えたリクエストを`CURL`を使い、webサーバに投げます。
3. アタッカーが入念に準備したCURLコマンドは成功し、EC2インスタンスに紐づけられたIAMインスタンスプロファイルのアクセスキーIDとシークレットアクセスキー、セッショントークンを取得できました。
4. IAMロールのクレデンシャルがある今、アタッカーはロールについている権限でクラウドを調査することができます。
5. アタッカーはプライベートなS3バケットを発見、識別し、アクセスすることができます。
6. プライベートなS3バケットの中には、機密情報が詰まったファイルがいくつかあり、アタッカーはそれらを自分の手元にダウンロードすることができます。

この方法のチートシートは[こちら](./cheat_sheet.md).
